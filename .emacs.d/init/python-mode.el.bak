(setq py-install-directory "~/.emacs.d/plugin/python-mode/")
(add-to-list 'load-path py-install-directory)
(require 'python-mode)

;;py-load-pymacs-p与安装的pymacs冲突
;(setq py-load-pymacs-p t)
;;ac-ropemacs-setup定义在auto-complete包提供的auto-complete-config.el文件中。
;;ac-ropemacs-setup依赖于ropemacs和pymacs
(add-to-list 'load-path "~/.emacs.d/plugin/Pymacs")
(load "pymacs")

(setq py-shell-name "ipython2")
(setq py-python-command "python2")

(defvar ac-ropemacs-loaded nil)
(defun ac-ropemacs-require ()
  (with-no-warnings
    (unless ac-ropemacs-loaded
      (pymacs-load "ropemacs" "rope-")
      (if (boundp 'ropemacs-enable-autoimport)
          (setq ropemacs-enable-autoimport t))
      (setq ac-ropemacs-loaded t))))

(defvar ac-ropemacs-completions-cache nil)
(defvar ac-source-ropemacs
  '((init
     . (lambda ()
         (setq ac-ropemacs-completions-cache
               (mapcar
                (lambda (completion)
                  (concat ac-prefix completion))
                (ignore-errors
                  (rope-completions))))))
    (candidates . ac-ropemacs-completions-cache)))

(defun ac-ropemacs-setup ()
  (ac-ropemacs-require)
  (setq ac-sources (append (list 'ac-source-ropemacs) ac-sources))
  (setq ac-omni-completion-sources '(("\\." ac-source-ropemacs))))

(defun ac-ropemacs-initialize ()
  (autoload 'pymacs-apply "pymacs")
  (autoload 'pymacs-call "pymacs")
  (autoload 'pymacs-eval "pymacs" nil t)
  (autoload 'pymacs-exec "pymacs" nil t)
  (autoload 'pymacs-load "pymacs" nil t)
  (add-hook 'python-mode-hook 'ac-ropemacs-setup)
  t)

(defun my-python-hook-mode ()
  (interactive)
  (setq ropemacs-mode t)
  (ac-ropemacs-initialize)
  )
(defalias 'python-proc 'python-shell-internal-get-or-create-process)
(add-hook 'python-mode-hook 'my-python-hook-mode)
